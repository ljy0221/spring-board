<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>게시글 상세</title>
</head>
<body>
	<!-- 로그인 정보 표시 -->
	<div
		style="text-align: right; padding: 10px; border-bottom: 1px solid #ddd;">
		<span th:if="${session.loginUser != null}"> <a th:href="@{/user/profile}">
		    <strong th:text="${session.loginUser.name}">사용자</strong>
		</a>님 환영합니다! <a
			th:href="@{/user/logout}">
				<button type="button">로그아웃</button>
		</a>
		</span> <span th:unless="${session.loginUser != null}"> <a
			th:href="@{/user/login}">
				<button type="button">로그인</button>
		</a>
		</span>
	</div>

	<h1>게시글 상세</h1>

	<table border="1">
		<tr>
			<th>번호</th>
			<td th:text="${board.id}"></td>
		</tr>
		<tr>
			<th>제목</th>
			<td th:text="${board.title}"></td>
		</tr>
		<tr>
			<th>작성자</th>
			<td th:text="${board.writer}"></td>
		</tr>
		<tr>
			<th>작성일</th>
			<td
				th:text="${#temporals.format(board.createdDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
		</tr>
		<tr>
			<th>수정일</th>
			<td
				th:text="${board.modifiedDate != null ? #temporals.format(board.modifiedDate, 'yyyy-MM-dd HH:mm:ss') : '-'}"></td>
		</tr>
		<tr>
			<th>조회수</th>
			<td th:text="${board.viewCount}"></td>
		</tr>
		<tr>
			<th>내용</th>
			<td>
				<div th:text="${board.content}" style="white-space: pre-wrap;"></div>
			</td>
		</tr>
	</table>

	<!-- 좋아요 영역 -->
	<div style="margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; text-align: center;">
	    <div>
	        <span style="font-size: 20px; margin-right: 10px;">
	            <!-- 좋아요 했으면 빨간 하트, 안 했으면 회색 하트 -->
	            <span th:if="${isLiked}" style="color: red;">♥</span>
	            <span th:unless="${isLiked}" style="color: gray;">♡</span>
	        </span>
	        <strong>좋아요 <span th:text="${likeCount}">0</span>개</strong>
	    </div>
	    
	    <!-- 로그인 시만 버튼 표시 -->
	    <div th:if="${session.loginUser != null}" style="margin-top: 10px;">
	        <form th:action="@{/board/{id}/like(id=${board.id})}" method="post" style="display: inline;">
	            <button type="submit" style="padding: 8px 20px; cursor: pointer;">
	                <span th:if="${isLiked}">좋아요 취소</span>
	                <span th:unless="${isLiked}">좋아요</span>
	            </button>
	        </form>
	    </div>
	    <div th:unless="${session.loginUser != null}">
	        <p style="color: #666; font-size: 14px; margin-top: 10px;">
	            좋아요를 누르려면 <a th:href="@{/user/login}">로그인</a>이 필요합니다.
	        </p>
	    </div>
	</div>
	
	<!-- 첨부파일 영역 -->
	<div th:if="${files != null && !files.isEmpty()}" 
	     style="margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;">
	    <h4 style="margin-top: 0;">📎 첨부파일 (<span th:text="${files.size()}">0</span>개)</h4>
	    <ul style="list-style: none; padding: 0; margin: 0;">
	        <li th:each="file : ${files}" style="padding: 8px 0; border-bottom: 1px solid #eee;">
	            <a th:href="@{/board/file/download/{fileId}(fileId=${file.id})}" 
	               style="text-decoration: none; color: #333;">
	                📄 <span th:text="${file.originalFileName}">파일명</span>
	                <span style="color: #999; font-size: 12px; margin-left: 10px;">
	                    (<span th:text="${#numbers.formatDecimal(file.fileSize / 1024.0, 1, 2)}">0</span> KB)
	                </span>
	            </a>
	        </li>
	    </ul>
	</div>

	<div>
		<a th:href="@{/board/list}">
			<button>목록</button>
		</a>
		<!-- 본인만 수정 버튼 보임 -->
		<a
			th:if="${session.loginUser != null && session.loginUser.name == board.writer}"
			th:href="@{/board/edit/{id}(id=${board.id})}">
			<button>수정</button>
		</a>
		<!-- 본인만 삭제 버튼 보임 -->
		<a
			th:if="${session.loginUser != null && session.loginUser.name == board.writer}"
			th:href="@{/board/delete/{id}(id=${board.id})}"
			onclick="return confirm('정말 삭제하시겠습니까?')">
			<button>삭제</button>
		</a>
	</div>

	<!-- 댓글 영역 -->
	<hr>
	<h3>
		댓글 (<span th:text="${#lists.size(comments)}">0</span>)
	</h3>

	<!-- 댓글 목록 -->
	<div th:if="${#lists.isEmpty(comments)}">
		<p>첫 댓글을 작성해보세요!</p>
	</div>

	<div th:unless="${#lists.isEmpty(comments)}">
		<div th:each="comment : ${comments}"
			style="border: 1px solid #ddd; padding: 10px; margin: 10px 0;">
			<div>
				<strong th:text="${comment.writer}">작성자</strong> <span
					th:text="${#temporals.format(comment.createdDate, 'yyyy-MM-dd HH:mm')}">2025-10-30
					14:30</span>
				<!-- 본인만 댓글 삭제 버튼 보임 -->
				<a
					th:if="${session.loginUser != null && session.loginUser.name == comment.writer}"
					th:href="@{/comment/delete/{id}(id=${comment.id}, boardId=${board.id})}"
					onclick="return confirm('댓글을 삭제하시겠습니까?')">
					<button type="button">삭제</button>
				</a>
			</div>
			<p th:text="${comment.content}" style="margin-top: 10px;">댓글 내용</p>
		</div>
	</div>

	<!-- 댓글 작성 폼 -->
	<h4>댓글 작성</h4>
	<!-- 로그인한 사용자만 댓글 작성 가능 -->
	<div th:if="${session.loginUser != null}">
		<form th:action="@{/comment/write}" method="post">
			<input type="hidden" name="boardId" th:value="${board.id}">
			<!-- 작성자 입력란 제거됨 (자동으로 로그인 사용자 이름 사용) -->
			<div>
				<label>댓글 내용:</label>
				<textarea name="content" rows="3" style="width: 100%;" required></textarea>
			</div>
			<div>
				<button type="submit">댓글 등록</button>
			</div>
		</form>
	</div>
	<div th:unless="${session.loginUser != null}">
		<p>
			댓글을 작성하려면 <a th:href="@{/user/login}">로그인</a>이 필요합니다.
		</p>
	</div>
</body>
</html>